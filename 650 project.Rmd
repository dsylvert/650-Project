---
title: "650 Project"
author: "Jess"
date: "11/28/2021"
output: html_document
---

```{r}
#load packages
#install.packages('ggplot2','dplyr','tidyverse','readxl','patchwork','lme4','effects',"devtools","emmeans","gridExtra") #install packages

library.list<- c('ggplot2','readxl','dplyr','tidyverse','patchwork','lme4','effects','sjPlot',"emmeans","gridExtra") #load packages
sapply(library.list, library, character.only=T, quietly=T)
library(NHANES)
#----
dat<-NHANES
head(dat)
quantile(dat$BMI, na.rm = TRUE)
dat$bmi_quan<-ifelse(dat$BMI<21.58, 1,
                            ifelse(21.58<=dat$BMI & dat$BMI<25.98,2,
                                   ifelse(25.98<=dat$BMI & dat$BMI<30.89, 3,
                                   ifelse(dat$BMI>=30.89,4,NA))))
# install.packages("gtsummary")
library(gtsummary)
dat2 <- dat %>% select(BPSysAve,BMI, bmi_quan)
dat2 %>% tbl_summary(by = bmi_quan)
```

```{r}
model_1<-lm(BPSysAve~BMI,data=dat)
summary(model_1)

plot_model(model_1,type="pred",show.data = TRUE)
plot_model(model_1,type="diag",show.data = TRUE)

```

```{r}
#I added the other covariates in groups, in a sequential pattern
dat3 <- dat %>% select(BPSysAve,BMI, bmi_quan,Age,Gender,Race1,Education)
dat3 %>% tbl_summary(by = bmi_quan)
#Demographic
model_2<-lm(BPSysAve~BMI+Gender+Race1+Education+Age,data=dat)
summary(model_2)

plot_model(model_2,type="diag",show.data = TRUE)
```

```{r}
#health variables:TotChol+Diabetes+PhysActive+SmokeNow
dat4 <- dat %>% select(BPSysAve,Age, BMI, bmi_quan,Age,Gender,Race1,Education,TotChol,Diabetes,PhysActive,SmokeNow)
dat4 %>% tbl_summary(by = bmi_quan)%>% add_p()%>%add_overall() %>%add_n()

model_3<-lm(BPSysAve~BMI+Age+Gender+Race1+Education+TotChol+Diabetes+PhysActive+SmokeNow,data=dat)
summary(model_3)

plot_model(model_3,type="diag",show.data = TRUE)
```

```{r}
#interaction terms: I know that total cholesteral tends to increase with age and there might be an interaction there. Also, I think age and sex might have an interaction (need to see if literature agrees)

model_4<-lm(BPSysAve~BMI+Age+Gender+Race1+Education+TotChol+Diabetes+PhysActive+SmokeNow+Age*Gender+Age*TotChol,data=dat)
summary(model_4)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
